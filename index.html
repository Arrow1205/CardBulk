<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft FC - PoC Complet</title>
    <style>
        :root {
            --primary: #10B981; --primary-dark: #059669; --bg: #F3F4F6;
            --card-bg: #FFFFFF; --text-main: #1F2937; --text-light: #6B7280; --border: #E5E7EB;
        }
        body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 5px solid var(--primary); }
        h1 { margin: 0; font-size: 24px; font-weight: 800; }
        .budget-badge { background: #ECFDF5; color: var(--primary-dark); padding: 8px 16px; border-radius: 99px; font-weight: 700; font-size: 18px; }
        button { background-color: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 15px; }
        button:hover { background-color: var(--primary-dark); transform: translateY(-1px); }
        button:disabled { background-color: #D1D5DB; cursor: not-allowed; transform: none; }
        .btn-outline { background-color: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background-color: var(--primary); color: white; }
        .section { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        .section.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .card { border: 1px solid var(--border); border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--border); }
        .card.ATT::before { background: #EF4444; } .card.MIL::before { background: #3B82F6; }
        .card.DEF::before { background: #F59E0B; } .card.GAR::before { background: #8B5CF6; }
        .card:hover:not(.disabled) { border-color: var(--primary); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .card.disabled { opacity: 0.4; cursor: not-allowed; background: #F9FAFB; }
        .card-name { font-weight: 700; font-size: 14px; margin-bottom: 4px; }
        .card-pos { font-size: 11px; color: var(--text-light); font-weight: 600; margin-bottom: 8px; }
        .card-price { font-weight: 800; color: var(--primary-dark); }
        .match-board { display: flex; justify-content: space-between; gap: 20px; }
        .team-col { flex: 1; border: 1px solid var(--border); border-radius: 10px; padding: 15px; }
        .score-display { text-align: center; font-size: 48px; font-weight: 900; margin: 20px 0; }
        .stat-line { display: flex; justify-content: space-between; font-size: 13px; padding: 8px 0; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Draft FC ⚽</h1>
        <div class="budget-badge" id="budget-badge">Budget: 400 M€</div>
    </div>
    <div id="screen-draft" class="section active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2>Sélection (<span id="draft-count">0</span>/5)</h2>
            <button id="roll-btn" class="btn-outline" onclick="rollPlayers()">Générer 5 joueurs</button>
        </div>
        <div class="grid" id="draft-board"></div>
        <h3 style="margin-top: 30px;">Mon Équipe</h3>
        <div class="grid" id="my-team-board"></div>
        <div style="text-align: center; margin-top: 20px;">
            <button id="start-match-btn" disabled onclick="startMatch()">Lancer le match vs IA</button>
        </div>
    </div>
    <div id="screen-match" class="section">
        <h2 style="text-align: center;">Résultat du Week-end</h2>
        <div class="score-display" id="final-score">0 - 0</div>
        <div class="match-board">
            <div class="team-col"><h3 style="color: var(--primary-dark);">Mon Équipe</h3><div id="my-match-stats"></div></div>
            <div class="team-col"><h3 style="color: #EF4444;">Ordinateur FC</h3><div id="bot-match-stats"></div></div>
        </div>
        <div style="text-align: center; margin-top: 30px; padding: 20px; background: #ECFDF5; border-radius: 8px;">
            <h3 id="match-verdict">Victoire ! (+100 M€)</h3>
            <p>Choisis UN joueur à conserver pour la semaine prochaine (Coût: 120%).</p>
            <div class="grid" id="keep-player-board" style="margin-bottom: 20px;"></div>
            <button onclick="nextWeek(null, 0)">Passer à la Semaine Suivante (sans conserver)</button>
        </div>
    </div>
</div>

<script>
    const db = [
        {id:1, n:"K. Mbappé", p:"ATT", v:180}, {id:2, n:"E. Haaland", p:"ATT", v:180}, {id:3, n:"Vini Jr", p:"ATT", v:150},
        {id:16, n:"J. Bellingham", p:"MIL", v:180}, {id:19, n:"Rodri", p:"MIL", v:110}, {id:26, n:"K. De Bruyne", p:"MIL", v:60},
        {id:31, n:"W. Saliba", p:"DEF", v:80}, {id:34, n:"A. Davies", p:"DEF", v:70}, {id:39, n:"Marquinhos", p:"DEF", v:60},
        {id:43, n:"G. Donnarumma", p:"GAR", v:40}, {id:44, n:"M. Maignan", p:"GAR", v:40}, {id:45, n:"Alisson", p:"GAR", v:32}
    ]; // Base raccourcie pour l'exemple

    let state = { budget: 400, myTeam: [], botTeam: [] };

    function showScreen(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function updateBudgetDisplay() { document.getElementById('budget-badge').innerText = `Budget: ${state.budget} M€`; }

    function rollPlayers() {
        if (state.myTeam.length >= 5) return;
        const board = document.getElementById('draft-board'); board.innerHTML = '';
        const shuffled = [...db].sort(() => 0.5 - Math.random()).slice(0, 5);
        shuffled.forEach(p => {
            const canAfford = state.budget >= p.v; const inTeam = state.myTeam.some(t => t.id === p.id);
            const card = document.createElement('div');
            card.className = `card ${p.p} ${(!canAfford || inTeam) ? 'disabled' : ''}`;
            card.innerHTML = `<div class="card-name">${p.n}</div><div class="card-pos">${p.p}</div><div class="card-price">${p.v} M€</div>`;
            if (canAfford && !inTeam) card.onclick = () => draftPlayer(p);
            board.appendChild(card);
        });
    }

    function draftPlayer(p) {
        state.myTeam.push(p); state.budget -= p.v; updateBudgetDisplay();
        document.getElementById('draft-count').innerText = state.myTeam.length;
        document.getElementById('draft-board').innerHTML = '<p style="text-align:center; grid-column: 1/-1;">Joueur drafté !</p>';
        document.getElementById('my-team-board').innerHTML = state.myTeam.map(p => `<div class="card ${p.p}"><div class="card-name">${p.n}</div></div>`).join('');
        if (state.myTeam.length === 5) { document.getElementById('roll-btn').disabled = true; document.getElementById('start-match-btn').disabled = false; }
    }

    function startMatch() {
        // Draft de l'IA
        state.botTeam = []; let botBudget = 400;
        [...db].sort(() => 0.5 - Math.random()).forEach(p => {
            if (botBudget >= p.v && state.botTeam.length < 5 && !state.myTeam.some(my => my.id === p.id)) { state.botTeam.push(p); botBudget -= p.v; }
        });

        // Simulation des stats
        const myConceded = Math.floor(Math.random() * 5); const botConceded = Math.floor(Math.random() * 5);
        const myResult = calculateStats(state.myTeam, myConceded); const botResult = calculateStats(state.botTeam, botConceded);

        // Calcul final selon ton barème
        let myScore = Math.max(0, (myResult.goals + botResult.penalty) - botResult.bonus);
        let botScore = Math.max(0, (botResult.goals + myResult.penalty) - myResult.bonus);

        document.getElementById('my-match-stats').innerHTML = myResult.logs.map(l => `<div class="stat-line"><b>${l.n}</b> <span>${l.text}</span></div>`).join('');
        document.getElementById('bot-match-stats').innerHTML = botResult.logs.map(l => `<div class="stat-line"><b>${l.n}</b> <span>${l.text}</span></div>`).join('');
        document.getElementById('final-score').innerText = `${myScore} - ${botScore}`;

        // Gestion de la victoire (+100M)
        const verdict = document.getElementById('match-verdict');
        if (myScore > botScore) { verdict.innerText = "Victoire ! (+100 M€)"; state.budget = 500; } 
        else { verdict.innerText = myScore < botScore ? "Défaite (Budget = 400M€)" : "Nul (Budget = 400M€)"; state.budget = 400; }

        // Préparation du joueur à conserver (120%)
        document.getElementById('keep-player-board').innerHTML = state.myTeam.map(p => {
            const cost = Math.round(p.v * 1.2);
            return `<div class="card ${p.p}" onclick="nextWeek(${p.id}, ${cost})"><div class="card-name">${p.n}</div><div style="color:#EF4444; font-weight:bold;">Gardé: ${cost} M€</div></div>`;
        }).join('');
        showScreen('screen-match');
    }

    function calculateStats(team, conceded) {
        let goals = 0; let bonus = 0; let penalty = 0; let logs = [];
        team.forEach(p => {
            let log = { n: p.n, text: "" };
            if (p.p === 'ATT') { const g = Math.floor(Math.random() * 3); goals += g; log.text = `${g} but(s)`; }
            else if (p.p === 'MIL') { const passes = Math.floor(Math.random() * 80) + 10; if (passes > 50) { goals += 1; log.text = `${passes} passes (+1 But)`; } else log.text = `${passes} passes`; }
            else if (p.p === 'DEF') { const t = Math.floor(Math.random() * 8); if (t > 5) { bonus += 1; log.text = `${t} tacles (-1 adv)`; } else log.text = `${t} tacles`; }
            else if (p.p === 'GAR') { log.text = `${conceded} but(s) pris`; }
            
            if (p.p === 'GAR' || p.p === 'DEF') {
                if (conceded === 0) { bonus += 1; log.text += " (Clean Sheet)"; }
                if (conceded > 3) { penalty += 1; log.text += " (Valise)"; }
            }
            logs.push(log);
        });
        return { goals, bonus, penalty, logs };
    }

    function nextWeek(id, cost) {
        state.myTeam = [];
        if (id) {
            if (state.budget < cost) { alert("Budget insuffisant !"); return; }
            state.myTeam.push(db.find(p => p.id === id)); state.budget -= cost;
        }
        document.getElementById('draft-board').innerHTML = '';
        document.getElementById('roll-btn').disabled = false; document.getElementById('start-match-btn').disabled = true;
        document.getElementById('draft-count').innerText = state.myTeam.length;
        document.getElementById('my-team-board').innerHTML = state.myTeam.map(p => `<div class="card ${p.p}"><div class="card-name">${p.n}</div></div>`).join('');
        updateBudgetDisplay(); showScreen('screen-draft');
    }

    rollPlayers();
</script>
</body>
</html>
